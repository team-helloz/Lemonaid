# í¬íŒ… ë§¤ë‰´ì–¼

## 1. ğŸ› ï¸ì‹œìŠ¤í…œ í™˜ê²½

### **AWS EC2**

Ubuntu 20.04 LTS

Jenkins 2.332.1

Nginx 1.18.0

Docker 20.10.13

Docker-compose 1.29.2

### **Cluster EC2**

Ubuntu 20.04.4 LTS

Hadoop 3.3.1

Sqoop 1.4.7

### **Database**

MySQL 8.0.28

## 2. ğŸ§‘ğŸ»â€ğŸ’»ê¸°ìˆ  ìŠ¤íƒ

### **Frontend**

IDE: VSCode

Node JS 16.13.x

Language: HTML5, Javascript, CSS3

Library: React 17.0.2, SCSS, TypeScript, Axios, Redux,

Open API: Kakao Map API

### **Backend**

IDE: IntelliJ 2021.3.1

Language: Java 1.8, Python 3.9

Framework: Spring Boot 2.4.5

Library: Spring-Boot-JPA,Spring Security, pandas

## 3. ğŸ‹Lemonaid **ë°°í¬ ìˆœì„œ**

1. ë°°í¬ ì „ë°˜ì— ì‚¬ìš©ë˜ëŠ” dockerì™€ docker-composeë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
2. nginxë¥¼ ì„¤ì¹˜í•˜ê³ , ì„¤ì • íŒŒì¼ì„ ìƒì„±í•´ nginxë¥¼ ê°€ë™ì‹œí‚µë‹ˆë‹¤.
3. ì´ë¯¸ì§€ ì •ì  íŒŒì¼ì„ ìœ„í•´ `/home/ubuntu/lemonaid/public/images` í´ë”ë¥¼ ë§Œë“¤ê³ , ì´ë¯¸ì§€ë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.
4. Git cloneì„ í†µí•´ Lemonaid ì†ŒìŠ¤ì½”ë“œë¥¼ ë‹¤ìš´ ë°›ìŠµë‹ˆë‹¤.
5. Lemonaid í´ë” ì•„ë˜ mysql í´ë”ë¡œ ì´ë™í•´ docker-composeë¥¼ ì‚¬ìš©í•´ ë¹Œë“œ í›„ ë°°í¬í•©ë‹ˆë‹¤.
6. Lemonaid í´ë”ë¡œ ì´ë™ í›„, docker-composeë¥¼ ì‚¬ìš©í•´ frontendì™€ backendë¥¼ ë¹Œë“œ í›„ ë°°í¬í•©ë‹ˆë‹¤.

### +) Jenkins ì‚¬ìš©

1. ìœ„ì˜ 1, 2ë²ˆì€ ë™ì¼í•˜ê²Œ ì§„í–‰í•œ í›„ dockerë¥¼ ì‚¬ìš©í•´ jenkinsë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
2. íŒŒì´í”„ë¼ì¸ ìƒì„± í›„, Gitlabê³¼ Mattermostë¥¼ ì—°ë™í•´ Webhookì„ ì„¤ì •í•©ë‹ˆë‹¤.
3. ë¹Œë“œ ë° ë°°í¬ê°€ ì„±ê³µì ì¸ ì§€ í™•ì¸í•©ë‹ˆë‹¤.

## 4. ğŸ“¦dockerì™€ docker-compose

ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì»¨í…Œì´ë„ˆì— ë‹´ì•„ ë°°í¬í•˜ê¸° ìœ„í•´ dockerë¥¼ ì‚¬ìš©í–ˆê³ , ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë“¤ì„ í•œêº¼ë²ˆì— ê´€ë¦¬í•˜ê¸° ìœ„í•´ docker-composeë¥¼ ê°™ì´ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

**docker ì„¤ì¹˜ ë°©ë²•**

```bash
$ sudo apt-get update
$ sudo apt-get install apt-transport-https ca-certificates curl gnupg lsb-release
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
$ echo \
  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
$ sudo apt-get update
$ sudo apt-get install docker-ce docker-ce-cli containerd.io
```

**docker ì‚¬ìš© ì˜ˆì‹œ**

```bash
$ docker run -itd --name jenkins -p 8080:8080 -p 50000:50000 \
-v /docker/jenkins:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock \
-e TZ=Asia/Seoul -u root jenkins/jenkins:latest
```

**docker-compose ì„¤ì¹˜ ë°©ë²•**

```bash
$ sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
$ sudo chmod +x /usr/local/bin/docker-compose
$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
$ docker-compose -version
```

**docker-compose ì‚¬ìš© ì˜ˆì‹œ**

docker-compose.yml íŒŒì¼ì´ ìˆëŠ” ìœ„ì¹˜ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
$ sudo docker-compose build # ë„ì»¤ ë¹Œë“œ
$ sudo docker-compose up -d # ë°±ê·¸ë¼ìš´ë“œë¡œ ë¹Œë“œí•œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
$ sudo docker-compose down # docker-compose ì™€ ê´€ë ¨ëœ ì´ë¯¸ì§€, ì»¨í…Œì´ë„ˆ ì¼ê´„ ì‚­ì œ
```

## 5. ğŸ¹Nginx

ì›¹ì„œë²„ì™€ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì—­í• ì„ í•˜ëŠ” nginxë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

**Nginx ì„¤ì¹˜**

```bash
$ sudo apt install nginx
```

1. Lemonaid í”„ë¡œì íŠ¸ì— ëŒ€í•œ ì„¤ì •íŒŒì¼ì„ ë§Œë“¤ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•©ë‹ˆë‹¤.

```bash
$ vi /etc/nginx/sites-available/lemonaid
```

```xml
server {

        location /{ # í”„ë¡ íŠ¸ì•¤ë“œ
                proxy_pass http://localhost:3000;
        }

        location /api { # ë°±ì—”ë“œ
                proxy_pass http://localhost:8888/api;
        }

	location /images { # ì •ì  ì´ë¯¸ì§€
		root /home/ubuntu/lemonaid/public/;
	}
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/j6d108.p.ssafy.io/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/j6d108.p.ssafy.io/privkey.pem; # managed by Certbot
    # include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    # ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}

server {
    if ($host = j6d108.p.ssafy.io) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

        listen 80;
        server_name j6d108.p.ssafy.io;
    return 404; # managed by Certbot
}
```

2.  ì €ì¥ í›„, í•´ë‹¹ íŒŒì¼ì˜ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ë‹¤ìŒ ê²½ë¡œì— ì¶”ê°€í•©ë‹ˆë‹¤.

```bash
$ ln -s /etc/nginx/sites-available/lemonaid /etc/nginx/sites-enabled/lemonaid
```

3. ì˜¬ë°”ë¥¸ ë¬¸ë²•ì¸ì§€ ê²€ì‚¬í•˜ê³ , ë‹¤ì‹œ ì¬ì‹¤í–‰ í•©ë‹ˆë‹¤.

```bash
$ sudo nginx -t
$ sudo service nginx restart
$ sudo systemctl status nginx
```

4. ë‹¨, HTTPSë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. ì¸ì¦ì„œëŠ” ìµœì´ˆ 1íšŒë§Œ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.

```bash
$ sudo apt-get install letsencrypt
$ sudo letsencrypt certonly --standalone -d j6d108.p.ssafy.io
```

## 6. ğŸ‘´ğŸ»Jenkins

ìœ„ì—ì„œ í•œ ì‘ì—…ë“¤ì„ ìë™í™” í•˜ëŠ” CI/CD íˆ´ë¡œ, docker ì‚¬ìš© ì˜ˆì‹œ í˜¹ì€ docker-compose.yml íŒŒì¼ë¡œ ì  í‚¨ìŠ¤ë¥¼ ë„ì»¤ë¡œ ë¹Œë“œí•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.

```bash
$ sudo docker exec jenkins cat /etc/var/jenkins_home/secrets/initialAmdinPassword
```

ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¡œê·¸ì¸ í›„, í•„ìš”í•œ íŒŒì´í”„ë¼ì¸ì„ ì„¤ì •í•´ GitLabê³¼ MatterMostë¥¼ ì—°ë™í•´ ì•ŒëŒì„ ë‚´ë³´ë‚´ê³ , GitLabì˜ ì´ë²¤íŠ¸ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë¹Œë“œí•˜ì—¬ ë°°í¬í•˜ë„ë¡ í•©ë‹ˆë‹¤.

## ğŸ”7. **í”„ë¡œì íŠ¸ ì†ì„± íŒŒì¼ ëª©ë¡**

í•´ë‹¹ íŒŒì¼ì€ backend/src/main/resources/application.ymlë¡œ DB ì—°ê²° ì„¤ì •ì„ í•˜ì—¬ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://j6d108.p.ssafy.io:3306/lemonaiddb?serverTimezone=Asia/Seoul
    username: { username }
    password: { password }
  jpa: #database
    show-sql: true #show hibernate sql
    hibernate:
      naming:
        implicit-strategy: org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy
        physical-strategy: org.springframework.boot.orm.jpa.hibernate.SpringPhysicalNamingStrategy
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL57Dialect
        format_sql: true #pretty formatting
```
